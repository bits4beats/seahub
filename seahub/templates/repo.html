{% extends "myhome_base.html" %}

{% load seahub_tags avatar_tags i18n upload_tags %}

{% block sub_title %}{{repo.name}} - {% endblock %}
{% block extra_style %}
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/select2.css?t=1393578720" />
<style type="text/css">
#footer { display:none; }
{% if repo.encrypted and repo.enc_version == 2 and not server_crypto %}
#main { display:none; }
{% endif %}
</style>    
<!-- Shim to make HTML5 elements usable in older Internet Explorer versions -->
<!--[if lt IE 9]><script src="{{ MEDIA_URL}}js/html5shiv.js"></script><![endif]-->
{% endblock %}

{% block main_panel %}
    <div id="repo-top">
        <h2 class="hd">{{repo.props.name}}{% if user_perm == 'r' %} <span class="tip vam">({% trans "Read-Only" %})</span>{% endif %}</h2>
            <div id="repo-basic-info">
                <span class="desc" title="{{repo.props.desc}}">{{ repo.props.desc|truncatechars:25 }}</span>
                <span class="size split">{% trans 'Size: ' %}{{ repo_size|filesizeformat }}</span>
                {% if show_repo_download_button or show_repo_settings or user_perm == 'rw' %}
                <span class="split">
                    {% if show_repo_download_button %}
                    <a href="{{ SITE_ROOT }}seafile_access_check/?repo_id={{repo.props.id}}" target="_blank">{% trans "Download" %}</a>
                    {% endif %}
                    {% if show_repo_settings %}
                    <a id="repo-setting-btn" href="{% url 'repo_settings' repo.id %}" class="normal"><img class="link-icon vam" src="{{ MEDIA_URL }}img/setting.png" alt="" /><span class="vam">{% trans "Settings" %}</span></a>
                    {% endif %}
                    {% if user_perm == 'rw' %}
                    <a id="recycle-btn" href="{% url 'repo_recycle_view' repo.id %}" class="normal"><img class="link-icon vam" src="{{ MEDIA_URL }}img/lib_trash.png" alt="" /><span class="vam">{% trans "Trash"%}</span></a>
                    {% endif %}
                </span>
                {% endif %}
            </div>
    </div>

    {% if repo.enc_version == 2 and not server_crypto and repo.encrypted %}
    <div id="repo-file-list"></div>
    {% else %}
    <script type="text/x-handlebars" data-template-name="index">
        {{html}}
    </script>
    <script type="text/x-handlebars">
    <div id="repo-file-list">
{{html}}
        {{outlet}}
    </div>
    </script>
        {#% include 'snippets/repo_dir_data.html' %#}
    {% endif %}

{% endblock %}

{% block extra_script %}
<script src="{{ MEDIA_URL}}js/handlebars.js"></script>
<script src="{{ MEDIA_URL}}js/ember.js"></script>

<script type="text/javascript">
var App = Ember.Application.create({
    LOG_TRANSITIONS: true 
}); 
App.Router.reopen({
    rootURL: '{{SITE_ROOT}}repo/{{repo.id}}/'
});
App.Router.map(function() {
    this.resource('application', { path: '/' });
});
App.ApplicationRoute = Ember.Route.extend({
    model: function() {
        return Ember.$.getJSON('{% url 'repo_dir_data' repo.id %}?p=' + e("{{ path|safe }}")).then(function(data) { return data; });
        //return {html: 'xx'};
    }
});
/*
App.IndexRoute = Ember.Route.extend({
  beforeModel: function() {
    this.transitionTo('application');
  }
});
*/
</script>
{% endblock %}
